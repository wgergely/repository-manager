# Repository Manager - Formalized Roadmap

**Date**: 2026-02-17
**Source**: Deep audit (6 agents, 7 reports) + vaultspec integration analysis
**Structure**: Hierarchical phases with foundational dependencies

---

## Guiding Principles

1. **Foundation first** - fix adoption blockers before adding features
2. **Test what matters** - the sync projection pipeline is the core value prop; it must be tested before anything else ships
3. **Vaultspec as plugin** - agent orchestration is the biggest competitive gap AND we have a sibling project that solves it; wrap don't rebuild
4. **Local-first moat** - single binary, no cloud dependency, privacy-first is a genuine differentiator in 2026
5. **Ship speed > feature completeness** - the market is moving fast (Augment Intent, Warp Oz are Feb 2026 entrants)

---

## Phase 0: Unblock Adoption (Foundation)

> **Goal**: A stranger can find, install, understand, and use the tool.
> **Dependency**: None. This is the foundation everything else builds on.
> **Effort**: 1-2 days

### 0.1 README Rewrite
- [ ] Value proposition headline (what + why in one sentence)
- [ ] Feature list with the 13-tool config sync front and center
- [ ] Installation instructions (`cargo install`, release binaries)
- [ ] Quick start (init -> add-tool -> sync -> verify)
- [ ] Terminal recording / ASCII demo
- [ ] Badges (CI, license, crates.io)
- **Source**: [01-user-experience.md](audits/2026-02-17-deep-audit/01-user-experience.md), [06-documentation-ux-synthesis.md](audits/2026-02-17-deep-audit/06-documentation-ux-synthesis.md)

### 0.2 Fix Config Schema Drift
- [ ] Update `config-schema.md` to match actual implementation
- [ ] Remove documented-but-unimplemented fields (`[active]`, `[core] version`, `[project] name`, `[sync] strategy`)
- [ ] Add actual fields with examples
- **Source**: [01-user-experience.md](audits/2026-02-17-deep-audit/01-user-experience.md) S2.5, [02-technical-audit.md](audits/2026-02-17-deep-audit/02-technical-audit.md) S6

### 0.3 Fix Init -> Sync Gap
- [ ] `repo init` should either auto-run sync OR print clear "Next step: run `repo sync`"
- [ ] Test: init a project, verify tool configs are generated (or user is told how)
- **Source**: [01-user-experience.md](audits/2026-02-17-deep-audit/01-user-experience.md) S3

### 0.4 Test the Core Value Proposition (GAP-004)
- [ ] Integration test: `.repository/config.toml` -> `repo sync` -> verify generated `.cursorrules`, `CLAUDE.md`, `.vscode/settings.json`
- [ ] This is the SINGLE MOST IMPORTANT test in the entire codebase
- **Source**: [03-test-verification.md](audits/2026-02-17-deep-audit/03-test-verification.md) S6

---

## Phase 1: Polish Core Experience

> **Goal**: The tool is pleasant and predictable to use.
> **Dependency**: Phase 0 complete
> **Effort**: 1-2 weeks

### 1.1 CLI Consistency
- [ ] Decide: flat (`add-tool`) vs nested (`tool add`) pattern - apply consistently
- [ ] Rename "superpowers" to "plugins" or "extensions"
- [ ] Update spec-cli.md with ALL implemented commands
- **Source**: [01-user-experience.md](audits/2026-02-17-deep-audit/01-user-experience.md) S4

### 1.2 Missing Commands
- [ ] `repo branch rename <old> <new>`
- [ ] `repo config show` (display current configuration)
- [ ] `repo tool info <tool>` (show what a tool integration provides)
- [ ] `--dry-run` flag on `add-tool`, `remove-tool`, `add-preset`, `remove-preset`
- **Source**: [01-user-experience.md](audits/2026-02-17-deep-audit/01-user-experience.md) S5

### 1.3 Interactive Init Improvements
- [ ] Add preset selection to interactive init flow
- [ ] Show summary of what will be created before confirming
- **Source**: [01-user-experience.md](audits/2026-02-17-deep-audit/01-user-experience.md) S3

### 1.4 Documentation Site
- [ ] Set up mdBook or Starlight for user-facing docs
- [ ] Create user guide: getting-started, configuration, tools reference, presets reference
- [ ] Separate user docs from design/contributor docs
- **Source**: [06-documentation-ux-synthesis.md](audits/2026-02-17-deep-audit/06-documentation-ux-synthesis.md) S3

### 1.5 Test Infrastructure
- [ ] Set up code coverage tooling (cargo-tarpaulin or cargo-llvm-cov)
- [ ] CLI end-to-end tests (not just command existence checks)
- [ ] Merge conflict resolution tests
- **Source**: [03-test-verification.md](audits/2026-02-17-deep-audit/03-test-verification.md) S7

---

## Phase 2: Vaultspec Integration (`repo agent`)

> **Goal**: Agent orchestration via vaultspec as an optional first-class plugin.
> **Dependency**: Phase 0 complete. Phase 1 can run in parallel.
> **Effort**: 2-4 weeks
> **Key Insight**: Vaultspec already implements orchestration, subagent management, A2A/ACP protocols, MCP server, rules engine, and multi-provider support. Wrapping it is dramatically cheaper than rebuilding.

### 2.1 Integration Architecture

**Strategy**: `repo` wraps `vaultspec` CLI as a subprocess with structured I/O.

```
repo agent <command>
    |
    v
repo-cli (Rust)
    |
    ├── Discovers vaultspec installation (PATH or configured location)
    ├── Translates repo agent commands -> vaultspec CLI invocations
    ├── Manages lifecycle (spawn, monitor, stop via process management)
    └── Captures output (structured JSON from vaultspec) -> repo format
```

**Why subprocess wrapping (not FFI/embedding)**:
- Vaultspec is Python; repo-manager is Rust - FFI is complex and fragile
- Subprocess invocation is the standard pattern (git itself works this way)
- Vaultspec's CLI is already well-structured for programmatic use
- Keeps both projects independently deployable and testable
- MCP protocol provides an additional structured communication channel

### 2.2 `repo agent` CLI Surface

```bash
# Core lifecycle
repo agent spawn --tool claude --worktree feature-auth [--prompt "..."]
repo agent spawn --tool gemini --worktree feature-ui [--prompt "..."]
repo agent list                         # Show running agents + status
repo agent stop <agent-id|worktree>     # Graceful shutdown
repo agent logs <agent-id|worktree>     # Stream/tail agent output

# Vaultspec-powered features (mapped from vaultspec capabilities)
repo agent task <description>           # Create orchestrated task (maps to vaultspec task engine)
repo agent subagent spawn <role>        # Spawn specialized subagent (researcher, executor, etc.)
repo agent rules lint                   # Validate agent rules consistency
repo agent status                       # Dashboard of all agent activity

# Configuration (stored in .repository/)
repo agent config --provider claude     # Set default AI provider
repo agent config --show                # Show agent configuration
```

### 2.3 Implementation Steps

#### Step A: Plugin Discovery & Health Check
- [ ] `repo agent --check` discovers vaultspec installation
- [ ] Validates version compatibility
- [ ] Reports available capabilities
- [ ] Graceful degradation when vaultspec not installed ("Install vaultspec for agent features: pip install vaultspec")

#### Step B: Basic Lifecycle (spawn/list/stop)
- [ ] `repo agent spawn` invokes vaultspec CLI in target worktree
- [ ] Process management (PID tracking, signal forwarding)
- [ ] `repo agent list` reads process state + vaultspec status
- [ ] `repo agent stop` sends graceful shutdown

#### Step C: Task Engine Integration
- [ ] `repo agent task` maps to vaultspec's task_engine
- [ ] Subagent spawning via vaultspec's orchestration module
- [ ] Task status reporting back to repo CLI

#### Step D: Protocol Bridge
- [ ] Expose vaultspec's MCP server through repo's MCP server
- [ ] A2A discovery integration (agents can find each other via repo)
- [ ] Unified logging (vaultspec agent logs -> repo's ledger)

### 2.4 Vaultspec Capabilities to Wrap

> **Note**: Full details in vaultspec audit reports. Summary of what maps to repo agent:

| Vaultspec Feature | Maps to `repo agent` | Priority |
|---|---|---|
| Task Engine (orchestration) | `repo agent task` | High |
| Subagent spawning | `repo agent subagent spawn` | High |
| A2A Protocol (agent-to-agent) | Agent discovery & communication | Medium |
| ACP Bridge (Claude) | `repo agent spawn --tool claude` | High |
| Provider system (Claude, Gemini) | Multi-provider support | High |
| MCP Subagent Server | `repo agent mcp` / protocol bridge | Medium |
| Rules system | `repo agent rules` | Medium |
| Skills system | Available agent capabilities | Medium |
| RAG module | Context search within agent sessions | Low |
| Sandbox | Agent isolation in worktrees | Medium |

### 2.5 What Changes in Each Project

**In repository-manager**:
- New `repo-agent` crate (or extend `repo-cli`)
- Plugin discovery system (find vaultspec binary)
- Process management for long-running agents
- Ledger integration for agent activity logging
- MCP server extensions for agent tools

**In vaultspec**:
- Stable CLI contract (versioned JSON output format)
- Headless/non-interactive mode for all commands
- Status reporting protocol (for `repo agent list`)
- Configuration bridge (read from `.repository/` when running under repo)

---

## Phase 3: Strategic Features

> **Goal**: Competitive differentiation and enterprise readiness.
> **Dependency**: Phase 1 complete. Phase 2 at least Step B.
> **Effort**: Ongoing

### 3.1 Worktree Lifecycle Hooks
- [ ] Pre/post worktree creation hooks (install deps, copy configs)
- [ ] Pre/post agent completion hooks (run tests, lint, validate)
- [ ] Hook configuration in `.repository/hooks/`
- **Source**: [05-feature-gaps-opportunities.md](audits/2026-02-17-deep-audit/05-feature-gaps-opportunities.md) S1.2

### 3.2 Config Governance
- [ ] `repo rules lint` - validate consistency across tools
- [ ] `repo rules diff` - show config drift
- [ ] `repo rules export --format agents` - AGENTS.md export
- [ ] `repo rules import AGENTS.md` - AGENTS.md import
- [ ] Ledger-based audit trail (who changed what, when)
- **Source**: [05-feature-gaps-opportunities.md](audits/2026-02-17-deep-audit/05-feature-gaps-opportunities.md) S3.2

### 3.3 `repo open` Command
- [ ] `repo open <worktree> [--tool cursor|vscode|zed]`
- [ ] Launch IDE/editor in specified worktree with configs applied
- **Source**: [05-feature-gaps-opportunities.md](audits/2026-02-17-deep-audit/05-feature-gaps-opportunities.md) S1.2

### 3.4 MCP Server Completion
- [ ] Implement git push/pull/merge MCP primitives
- [ ] MCP server health checks
- [ ] MCP server discovery (suggest servers based on project stack)
- **Source**: [02-technical-audit.md](audits/2026-02-17-deep-audit/02-technical-audit.md) S10

### 3.5 Global Config Layer
- [ ] `~/.config/repo/` for user-level defaults
- [ ] Org-level config layer (git-hosted shared config)
- [ ] Config hierarchy: global -> org -> project -> worktree
- **Source**: [02-technical-audit.md](audits/2026-02-17-deep-audit/02-technical-audit.md) S6

---

## Phase 4: Ecosystem & Scale

> **Goal**: Platform-level capabilities.
> **Dependency**: Phases 0-2 complete, Phase 3 substantially complete.
> **Effort**: Long-term

### 4.1 Issue-to-Worktree Automation
- [ ] `repo issue assign <issue-url>` -> creates worktree + spawns agent
- [ ] Auto-link worktree PR to originating issue
- [ ] GitHub/GitLab API integration

### 4.2 Optional Cloud Bridge
- [ ] `repo cloud spawn --provider daytona` for remote execution
- [ ] Keep local-first as default; cloud is opt-in

### 4.3 Interactive TUI
- [ ] Fuzzy worktree selection
- [ ] Status dashboard (worktrees, agents, config health)
- [ ] Real-time agent log streaming

### 4.4 Skills Marketplace Bridge
- [ ] Integration with Tessl registry or similar
- [ ] `repo skills search / install / list`

---

## Dependency Graph

```
Phase 0 (Foundation)
├── 0.1 README ─────────────────────────────────┐
├── 0.2 Config Schema Fix ──────────────────────┤
├── 0.3 Init -> Sync Fix ──────────────────────┤
└── 0.4 GAP-004 Test ──────────────────────────┤
                                                 │
Phase 1 (Polish)              Phase 2 (Agent)    │
├── 1.1 CLI Consistency       ├── 2.3A Discovery │ ← depends on Phase 0
├── 1.2 Missing Commands      ├── 2.3B Lifecycle │ ← depends on 2.3A
├── 1.3 Interactive Init      ├── 2.3C Task Eng. │ ← depends on 2.3B
├── 1.4 Doc Site              └── 2.3D Protocol  │ ← depends on 2.3B
└── 1.5 Test Infra                               │
         │                         │              │
         └─────────────┬───────────┘              │
                        │                          │
                  Phase 3 (Strategic)              │
                  ├── 3.1 Hooks ← 2.3B            │
                  ├── 3.2 Governance               │
                  ├── 3.3 repo open                │
                  ├── 3.4 MCP Completion           │
                  └── 3.5 Global Config            │
                        │                          │
                  Phase 4 (Ecosystem)              │
                  └── 4.1-4.4                      │
```

---

## Key Metrics to Track

| Metric | Current | Phase 0 Target | v1.0 Target |
|--------|---------|----------------|-------------|
| README completeness | 2/10 sections | 10/10 | 10/10 |
| Installation path | None | `cargo install` works | Multi-method |
| Test count | 1,078 | 1,100+ (GAP-004 closed) | 1,500+ |
| Sync pipeline tested | No | Yes | Full coverage |
| User docs pages | 0 | 3 (README, getting-started, tools-ref) | 10+ |
| Agent orchestration | None | Basic (spawn/list/stop) | Full (tasks, subagents) |
| Doc UX rating | 2.0/5 | 3.5/5 | 4.5/5 |

---

## Cross-References

- [00-audit-index.md](audits/2026-02-17-deep-audit/00-audit-index.md) - Master audit summary
- [01-user-experience.md](audits/2026-02-17-deep-audit/01-user-experience.md) - UX findings
- [02-technical-audit.md](audits/2026-02-17-deep-audit/02-technical-audit.md) - Technical capabilities
- [03-test-verification.md](audits/2026-02-17-deep-audit/03-test-verification.md) - Test results
- [04-competitive-landscape.md](audits/2026-02-17-deep-audit/04-competitive-landscape.md) - Competitors
- [05-feature-gaps-opportunities.md](audits/2026-02-17-deep-audit/05-feature-gaps-opportunities.md) - Gaps & opportunities
- [06-documentation-ux-synthesis.md](audits/2026-02-17-deep-audit/06-documentation-ux-synthesis.md) - Doc UX
- `vaultspec-01-core-systems.md` - Vaultspec core audit (pending)
- `vaultspec-02-protocol-layer.md` - Vaultspec protocol audit (pending)
- `vaultspec-03-rules-agents-skills.md` - Vaultspec declarative systems audit (pending)
- `vaultspec-04-integration-viability.md` - Integration plan (pending)

---

*Roadmap created: 2026-02-17*
*Will be updated with vaultspec audit findings when available.*
